<!-- ========================= CONTENIDO PRINCIPAL ========================= -->
<main>
  <!-- ========================= ENCABEZADO DE LA P√ÅGINA ========================= -->
  <div class="page-header">
    <h2 class="page-title">
      <span class="page-title-icon">üßæ</span>
      Generar factura de venta
    </h2>
  </div>

  <!-- ========================= SECCI√ìN DE DATOS DEL CLIENTE ========================= -->
  <div class="section-card">
    <h3 class="section-title">
      <span>üë§</span>
      Datos del cliente
    </h3>
    
    <!-- Formulario de datos del cliente -->
    <form class="customer-form">
      <!-- Fila con campo de c√©dula y botones -->
      <div class="form-row">
        <div class="form-group" style="width: 200px;">
          <label class="form-label">C√©dula</label>
          <input type="text" class="form-input" id="cedula" placeholder="Escribir c√©dula" [(ngModel)]="cedulaCliente" name="cedulaCliente">
        </div>
        <div></div>
        <div style="display: flex; gap: 10px;">
          <button type="button" class="btn btn-primary" (click)="buscarCliente()">
            üîç Buscar cliente
          </button>
          <button type="button" class="btn btn-secondary" (click)="registrarCliente()">
            ‚ûï Registrar cliente
          </button>
        </div>
      </div>
      
      <!-- Campo de nombre del cliente -->
      <div class="form-group">
        <label class="form-label">Se√±or(a)</label>
        <input type="text" class="form-input" id="customerName" placeholder="Nombre completo del cliente" [value]="cliente.nombre" disabled>
      </div>
      
      <!-- Campo de tel√©fono del cliente -->
      <div class="form-group">
        <label class="form-label">Tel√©fono</label>
        <input type="tel" class="form-input" id="phone" placeholder="N√∫mero de tel√©fono" [value]="cliente.telefono" disabled>
      </div>
      
      <!-- Campo de correo del cliente -->
      <div class="form-group">
        <label class="form-label">Correo</label>
        <input type="email" class="form-input" id="email" placeholder="Correo electr√≥nico" [value]="cliente.correo" disabled>
      </div>
    </form>
  </div>

  <!-- ========================= SECCI√ìN DE PRODUCTOS ========================= -->
  <div class="section-card">
    <!-- Encabezado de la secci√≥n de productos -->
    <div class="products-header">
      <h3 class="section-title" style="margin-bottom: 0;">
        Lista de productos
      </h3>
      <button class="btn btn-primary" (click)="agregarProducto()">
        Agregar producto
      </button>
    </div>

    <!-- Contenedor de productos -->
    <div id="productsContainer">
      <!-- Tabla de productos -->
      <table class="products-table" id="productsTable" *ngIf="listaProductos.data.length > 0">
        <thead>
          <tr>
            <th style="width: 80px;">ID</th>
            <th>Descripci√≥n</th>
            <th style="width: 200px;">Estado</th>
            <th style="width: 150px;">Precio</th>
            <th style="width: 150px;">Eliminar producto</th>
          </tr>
        </thead>
        <tbody id="productsTableBody">
          <tr *ngFor="let element of listaProductos.data; let i = index" style="animation: fadeInUp 0.3s ease">
            <td>{{element.id}}</td>
            <td>{{element.Descripcion}}</td>
            <td>
              <mat-form-field appearance="fill">
                <mat-select [(ngModel)]="element.Estado" (selectionChange)="cambiarEstado($event.value, element.id)" [name]="'estado_' + element.id">
                  <mat-option *ngFor="let estado of estadosDisponibles" [value]="estado">
                    {{ estado }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </td>
            <td>${{element.Precio.toLocaleString()}}</td>
            <td style="text-align: center;">
              <button class="delete-btn" (click)="eliminarProducto(element.id)">
                üóëÔ∏è Eliminar
              </button>
            </td>
          </tr>
        </tbody>
      </table>

      <!-- Estado vac√≠o - cuando no hay productos -->
      <div class="empty-products" *ngIf="listaProductos.data.length === 0">
        <div class="empty-icon">üõí</div>
        <h4>No hay productos agregados</h4>
        <p>Haz clic en "Agregar producto" para comenzar</p>
      </div>

      <!-- Secci√≥n de total de la factura -->
      <div class="total-section" *ngIf="listaProductos.data.length > 0">
        <span class="total-label">Valor total factura</span>
        <span class="total-value">${{valorTotalFactura.toLocaleString()}}</span>
      </div>
    </div>
  </div>

  <!-- ========================= SECCI√ìN DE PAGO ========================= -->
  <div class="section-card">
    <h3 class="section-title">
      <span>üí≥</span>
      Pago
    </h3>
    
    <!-- Grid de campos de pago -->
    <div class="payment-grid">
      <!-- Campo de m√©todo de pago -->
      <div class="form-group">
        <label class="form-label">M√©todo de pago</label>
        <mat-form-field appearance="fill">
          <mat-select [(ngModel)]="metodoPago" name="metodoPago" class="form-select">
            <mat-option *ngFor="let opcion of opcionesPago" [value]="opcion">
              {{ opcion }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>
      
      <!-- Campo de valor a pagar -->
      <div class="form-group">
        <label class="form-label">Valor a pagar</label>
        <input type="number" class="form-input" id="paymentAmount" placeholder="0" min="0" [(ngModel)]="valorPago" name="valorPago">
      </div>
    </div>
  </div>

  <!-- ========================= BOT√ìN DE GENERAR FACTURA ========================= -->
  <div class="generate-section">
    <button class="btn-generate" (click)="generarFactura()">
      <span>üìÑ</span>
      <span>Generar factura</span>
    </button>
  </div>
</main>