<!-- ========================= CONTENIDO PRINCIPAL ========================= -->
<main>
  <!-- ========================= ENCABEZADO DE LA P√ÅGINA ========================= -->
  <div class="page-header">
    <h1 class="page-title">Generar Factura de Venta</h1>
    <p class="page-subtitle">Crea y gestiona facturas para la venta de productos</p>
  </div>

  <!-- ========================= SECCI√ìN DE DATOS DEL CLIENTE ========================= -->
  <div class="section-card">
    <h3 class="section-title">
      <span>üë§</span>
      Datos del cliente
    </h3>
    
    <!-- Formulario de datos del cliente -->
    <form class="customer-form">
      <!-- Fila con campo de c√©dula y botones -->
      <div class="form-row">
        <div class="form-group" style="width: 200px;">
          <label class="form-label">C√©dula</label>
          <input type="text" class="form-input" id="cedula" placeholder="Escribir c√©dula" [(ngModel)]="cedulaCliente" name="cedulaCliente">
        </div>
        <div></div>
        <div style="display: flex; gap: 10px;">
          <button type="button" class="btn btn-primary" (click)="buscarCliente()">
            üîç Buscar cliente
          </button>
          <button type="button" class="btn btn-secondary" (click)="registrarCliente()">
            ‚ûï Registrar cliente
          </button>
        </div>
      </div>
      
      <!-- Campo de nombre del cliente -->
      <div class="form-group">
        <label class="form-label">Se√±or(a)</label>
        <input type="text" class="form-input" id="customerName" placeholder="Nombre completo del cliente" [value]="cliente.nombre" disabled>
      </div>
      
      <!-- Campo de tel√©fono del cliente -->
      <div class="form-group">
        <label class="form-label">Tel√©fono</label>
        <input type="tel" class="form-input" id="phone" placeholder="N√∫mero de tel√©fono" [value]="cliente.telefono" disabled>
      </div>
      
      <!-- Campo de correo del cliente -->
      <div class="form-group">
        <label class="form-label">Correo</label>
        <input type="email" class="form-input" id="email" placeholder="Correo electr√≥nico" [value]="cliente.correo" disabled>
      </div>
    </form>
  </div>

  <!-- ========================= SECCI√ìN DE PRODUCTOS ========================= -->
  <div class="section-card">
    <!-- Encabezado de la secci√≥n de productos -->
    <div class="products-header">
      <h3 class="section-title" style="margin-bottom: 0;">
        Lista de productos
      </h3>
      <button class="btn btn-primary" (click)="agregarProducto()">
        Agregar producto
      </button>
    </div>

    <!-- Contenedor de productos -->
    <div id="productsContainer">
      <!-- Tabla de productos -->
      <div class="table-container" *ngIf="listaProductos.data.length > 0">
        <table class="products-table" id="productsTable">
          <thead>
            <tr>
              <th class="th-id">ID</th>
              <th class="th-producto">Producto</th>
              <th class="th-talla">Talla</th>
              <th class="th-tipo">Horario</th>
              <th class="th-genero">G√©nero</th>
              <th class="th-categoria">Institucion</th>
              <th class="th-estado">Estado</th>
              <th class="th-precio">Precio</th>
              <th class="th-descripcion">Descripci√≥n</th>
              <th class="th-accion">Acci√≥n</th>
            </tr>
          </thead>
          <tbody id="productsTableBody">
            <tr *ngFor="let element of listaProductos.data; let i = index" 
                class="product-row">
              <td class="td-id">{{element.id}}</td>
              <td class="td-producto">{{element.Descripcion}}</td>
              <td class="td-talla">
                <span class="talla-badge">{{element.Talla || 'N/A'}}</span>
              </td>
              <td class="td-tipo">{{element.Horario || 'N/A'}}</td>
              <td class="td-genero">{{element.Genero || 'N/A'}}</td>
              <td class="td-categoria">{{element.Institucion || 'N/A'}}</td>
              <td class="td-estado">
                <select class="estado-select" 
                        [(ngModel)]="element.Estado" 
                        (ngModelChange)="cambiarEstado($event, element.id)" 
                        [name]="'estado_' + element.id">
                  <option *ngFor="let estado of estadosDisponibles" [value]="estado">
                    {{ estado }}
                  </option>
                </select>
              </td>
              <td class="td-precio">${{element.Precio.toLocaleString()}}</td>
              <td class="td-descripcion">
                <button 
                  class="descripcion-btn" 
                  (click)="agregarDescripcion(element.id)"
                  [title]="element.descripcionExtra ? 'Editar descripci√≥n' : 'Agregar descripci√≥n'">
                  üí¨ {{element.descripcionExtra ? 'Editar' : 'Agregar'}}
                </button>
                <div *ngIf="element.descripcionExtra" 
                     class="descripcion-preview" 
                     [title]="element.descripcionExtra">
                  {{element.descripcionExtra}}
                </div>
              </td>
              <td class="td-accion">
                <div class="action-buttons">
                  <button class="duplicate-btn" (click)="duplicarProducto(element.id)" title="Duplicar producto">
                    üìã
                  </button>
                  <button class="delete-btn" (click)="eliminarProducto(element.id)" title="Eliminar producto">
                    üóëÔ∏è
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Estado vac√≠o - cuando no hay productos -->
      <div class="empty-products" *ngIf="listaProductos.data.length === 0">
        <div class="empty-icon">üõí</div>
        <h4>No hay productos agregados</h4>
        <p>Haz clic en "Agregar producto" para comenzar</p>
      </div>

      <!-- Footer de la tabla -->
      <div class="table-footer" *ngIf="listaProductos.data.length > 0">
        <div class="products-count">
          <span class="count-text">{{listaProductos.data.length}} productos</span>
        </div>
        <div class="total-section">
          <div class="total-label">Valor total factura</div>
          <div class="total-value">${{valorTotalFactura.toLocaleString()}}</div>
        </div>
      </div>
    </div>
  </div>

  <!-- ========================= SECCI√ìN DE PAGO ========================= -->
  <div class="section-card">
    <h3 class="section-title">
      <span>üí≥</span>
      Pago
    </h3>
    
    <!-- Grid de campos de pago -->
    <div class="payment-grid">
      <!-- Campo de m√©todo de pago -->
      <div class="form-group">
        <label class="form-label">M√©todo de pago</label>
        <select class="estado-select payment-select" 
                [(ngModel)]="metodoPago" 
                name="metodoPago">
          <option value="">Seleccionar m√©todo de pago</option>
          <option *ngFor="let opcion of opcionesPago" [value]="opcion">
            {{ opcion }}
          </option>
        </select>
      </div>
      
      <!-- Campo de valor a pagar -->
      <div class="form-group">
        <label class="form-label">Valor a pagar</label>
        <input type="number" class="form-input" id="paymentAmount" placeholder="0" min="0" [(ngModel)]="valorPago" name="valorPago" (input)="valorPago = valorPago < 0 ? 0 : valorPago">
      </div>
    </div>
  </div>

  <!-- ========================= BOT√ìN DE GENERAR FACTURA ========================= -->
  <div class="generate-section">
    <button class="btn-generate" (click)="generarFactura()">
      <span>üìÑ</span>
      <span>Generar factura</span>
    </button>
  </div>

  <!-- ========================= MODAL DE DESCRIPCI√ìN ========================= -->
  <div *ngIf="showDescriptionDialog" class="description-modal-overlay">
    <div class="description-modal">
      <div class="modal-header">
        <h3 class="modal-title">
          {{selectedProductDescription ? 'Editar descripci√≥n' : 'Agregar descripci√≥n'}}
        </h3>
        <button class="modal-close-btn" (click)="handleCancelDescription()">
          ‚úï
        </button>
      </div>
      
      <div class="modal-body">
        <label class="modal-label">Descripci√≥n del producto</label>
        <textarea 
          [(ngModel)]="tempDescription"
          name="tempDescription"
          class="modal-textarea"
          rows="4"
          placeholder="Ingrese una descripci√≥n para el producto...">
        </textarea>
      </div>
      
      <div class="modal-footer">
        <button class="btn-modal-cancel" (click)="handleCancelDescription()">
          Cancelar
        </button>
        <button class="btn-modal-save" (click)="handleSaveDescription()">
          Guardar
        </button>
      </div>
    </div>
  </div>

  <!-- Toast Notification Component -->
  <app-toast-notification></app-toast-notification>
</main>