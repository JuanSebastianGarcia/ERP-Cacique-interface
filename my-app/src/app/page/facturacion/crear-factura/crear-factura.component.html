<!-- Main Content -->
<main>
  <!-- Page Header -->
  <div class="page-header">
    <h2 class="page-title">
      <span class="page-title-icon">🧾</span>
      Generar factura de venta
    </h2>
  </div>

  <!-- Customer Data Section -->
  <div class="section-card">
    <h3 class="section-title">
      <span>👤</span>
      Datos del cliente
    </h3>
    
    <form class="customer-form">
      <div class="form-row">
        <div class="form-group" style="width: 200px;">
          <label class="form-label">Cédula</label>
          <input type="text" class="form-input" id="cedula" placeholder="Escribir cédula" [(ngModel)]="cedulaCliente" name="cedulaCliente">
        </div>
        <div></div>
        <div style="display: flex; gap: 10px;">
          <button type="button" class="btn btn-primary" (click)="buscarCliente()">
            🔍 Buscar cliente
          </button>
          <button type="button" class="btn btn-secondary" (click)="registrarCliente()">
            ➕ Registrar cliente
          </button>
        </div>
      </div>
      
      <div class="form-group">
        <label class="form-label">Señor(a)</label>
        <input type="text" class="form-input" id="customerName" placeholder="Nombre completo del cliente" [value]="cliente.nombre" disabled>
      </div>
      
      <div class="form-group">
        <label class="form-label">Teléfono</label>
        <input type="tel" class="form-input" id="phone" placeholder="Número de teléfono" [value]="cliente.telefono" disabled>
      </div>
      
      <div class="form-group">
        <label class="form-label">Correo</label>
        <input type="email" class="form-input" id="email" placeholder="Correo electrónico" [value]="cliente.correo" disabled>
      </div>
    </form>
  </div>

  <!-- Products Section -->
  <div class="section-card">
    <div class="products-header">
      <h3 class="section-title" style="margin-bottom: 0;">
        Lista de productos
      </h3>
      <button class="btn btn-primary" (click)="agregarProducto()">
        Agregar producto
      </button>
    </div>

    <div id="productsContainer">
      <!-- Products Table -->
      <table class="products-table" mat-table [dataSource]="listaProductos" *ngIf="listaProductos.data.length > 0">
        <thead>
          <tr>
            <th style="width: 80px;">ID</th>
            <th>Descripción</th>
            <th style="width: 200px;">Estado</th>
            <th style="width: 150px;">Precio</th>
            <th style="width: 150px;">Eliminar producto</th>
          </tr>
        </thead>
        <tbody>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;" style="animation: fadeInUp 0.3s ease">
            <td mat-cell *matCellDef="let element">{{element.id}}</td>
            <td mat-cell *matCellDef="let element">{{element.Descripcion}}</td>
            <td mat-cell *matCellDef="let element">
              <mat-form-field appearance="fill">
                <mat-select [(ngModel)]="element.Estado" (selectionChange)="cambiarEstado($event.value, element.id)" [name]="'estado_' + element.id">
                  <mat-option *ngFor="let estado of estadosDisponibles" [value]="estado">
                    {{ estado }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </td>
            <td mat-cell *matCellDef="let element">${{element.Precio.toLocaleString()}}</td>
            <td mat-cell *matCellDef="let element" style="text-align: center;">
              <button class="delete-btn" (click)="eliminarProducto(element.id)">
                🗑️ Eliminar
              </button>
            </td>
          </tr>
        </tbody>
      </table>

      <!-- Empty State -->
      <div class="empty-products" *ngIf="listaProductos.data.length === 0">
        <div class="empty-icon">🛒</div>
        <h4>No hay productos agregados</h4>
        <p>Haz clic en "Agregar producto" para comenzar</p>
      </div>

      <!-- Total Section -->
      <div class="total-section" *ngIf="listaProductos.data.length > 0">
        <span class="total-label">Valor total factura</span>
        <span class="total-value">${{valorTotalFactura.toLocaleString()}}</span>
      </div>
    </div>
  </div>

  <!-- Payment Section -->
  <div class="section-card">
    <h3 class="section-title">
      <span>💳</span>
      Pago
    </h3>
    
    <div class="payment-grid">
      <div class="form-group">
        <label class="form-label">Método de pago</label>
        <mat-form-field appearance="fill">
          <mat-select [(ngModel)]="metodoPago" name="metodoPago" class="form-select">
            <mat-option *ngFor="let opcion of opcionesPago" [value]="opcion">
              {{ opcion }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>
      
      <div class="form-group">
        <label class="form-label">Valor a pagar</label>
        <input type="number" class="form-input" id="paymentAmount" placeholder="0" min="0" [(ngModel)]="valorPago" name="valorPago">
      </div>
    </div>
  </div>

  <!-- Generate Invoice Button -->
  <div class="generate-section">
    <button class="btn-generate" (click)="generarFactura()">
      <span>📄</span>
      <span>Generar factura</span>
    </button>
  </div>
</main>
