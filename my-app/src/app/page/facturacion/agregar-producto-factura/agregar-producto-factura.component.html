<!-- Modal for Add Product -->
<div class="modal-overlay active">
  <div class="modal-container modal-compact">
    <div class="modal-header-bar">
      <h3 class="modal-title-bar">Agregar producto</h3>
    </div>
    
    <form (ngSubmit)="agregar()" #productForm="ngForm">
      <div class="modal-body">
        <div class="select-grid">
          <div class="select-group">
            <label class="select-label">Prenda</label>
            <select class="form-select compact-select" [(ngModel)]="producto.prenda" name="prenda" required>
              <option value="">Selecciona una prenda</option>
              <option *ngFor="let item of prendas" [value]="item">{{ item }}</option>
            </select>
          </div>

          <div class="select-group">
            <label class="select-label">Talla</label>
            <select class="form-select compact-select" [(ngModel)]="producto.talla" name="talla" required>
              <option value="">Selecciona una talla</option>
              <option *ngFor="let item of tallas" [value]="item">{{ item }}</option>
            </select>
          </div>

          <div class="select-group">
            <label class="select-label">Instituci√≥n</label>
            <select class="form-select compact-select" [(ngModel)]="producto.institucion" name="institucion" required>
              <option value="">Selecciona una instituci√≥n</option>
              <option *ngFor="let item of instituciones" [value]="item">{{ item }}</option>
            </select>
          </div>

          <div class="select-group">
            <label class="select-label">G√©nero</label>
            <select class="form-select compact-select" [(ngModel)]="producto.genero" name="genero" required>
              <option value="">Selecciona un g√©nero</option>
              <option *ngFor="let item of generos" [value]="item">{{ item }}</option>
            </select>
          </div>

          <div class="select-group">
            <label class="select-label">Horario</label>
            <select class="form-select compact-select" [(ngModel)]="producto.horario" name="horario" required>
              <option value="">Selecciona un horario</option>
              <option *ngFor="let item of horarios" [value]="item">{{ item }}</option>
            </select>
          </div>
        </div>

        <!-- Nueva secci√≥n de productos -->
        <div class="products-section">
          <div class="products-header">
            <h4 class="products-title">üì¶ Productos Disponibles</h4>
            <div class="view-toggle">
              <button type="button" class="view-btn active" (click)="toggleView('grid')">‚öè</button>
              <button type="button" class="view-btn" (click)="toggleView('table')">‚ò∞</button>
            </div>
          </div>

          <!-- Vista Grid -->
          <div class="products-grid" *ngIf="currentView === 'grid'">
            <div class="product-card" *ngFor="let product of productosDisponibles" 
                 [class.selected]="productosSeleccionados.has(product.id)"
                 (click)="toggleProducto(product.id)">
              <div class="selected-badge" *ngIf="productosSeleccionados.has(product.id)">‚úì</div>
              <div class="product-header">
                <div>
                  <div class="product-name">{{ product.prenda }}</div>
                  <div class="product-institution">{{ product.institucion }}</div>
                </div>
                <div class="product-price">{{ product.precio | currency:'COP':'symbol':'1.0-0' }}</div>
              </div>
              <div class="product-attributes">
                <div class="product-attribute"><strong>Talla:</strong> {{ product.talla }}</div>
                <div class="product-attribute"><strong>Horario:</strong> {{ product.horario }}</div>
                <div class="product-attribute"><strong>G√©nero:</strong> {{ product.genero }}</div>
              </div>
              <div class="stock-indicator">
                <span class="stock-badge" [ngClass]="getStockClass(product.cantidad)">
                  {{ product.cantidad }} en stock
                </span>
              </div>
              <div class="product-actions">
                <div class="quantity-selector" *ngIf="productosSeleccionados.has(product.id)">
                  <button type="button" class="quantity-btn" (click)="cambiarCantidad(product.id, -1)">-</button>
                  <input type="number" class="quantity-input" 
                         [value]="productosSeleccionados.get(product.id) || 1" 
                         min="1" [max]="product.cantidad"
                         (change)="actualizarCantidad(product.id, $event)">
                  <button type="button" class="quantity-btn" (click)="cambiarCantidad(product.id, 1)">+</button>
                </div>
                <button type="button" class="add-to-cart-btn" 
                        [class.remove-btn]="productosSeleccionados.has(product.id)"
                        (click)="toggleProducto(product.id)">
                  {{ productosSeleccionados.has(product.id) ? 'üóëÔ∏è Quitar' : 'üõí Agregar' }}
                </button>
              </div>
            </div>
          </div>

          <!-- Vista Tabla -->
          <div class="products-table-container" *ngIf="currentView === 'table'">
            <table class="products-table">
              <thead>
                <tr>
                  <th>Prenda</th>
                  <th>Instituci√≥n</th>
                  <th>Talla</th>
                  <th>Horario</th>
                  <th>G√©nero</th>
                  <th>Precio</th>
                  <th>Stock</th>
                  <th>Acciones</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let product of productosDisponibles" 
                    [class.selected]="productosSeleccionados.has(product.id)">
                  <td>{{ product.prenda }}</td>
                  <td>{{ product.institucion }}</td>
                  <td>{{ product.talla }}</td>
                  <td>{{ product.horario }}</td>
                  <td>{{ product.genero }}</td>
                  <td>{{ product.precio | currency:'COP':'symbol':'1.0-0' }}</td>
                  <td><span class="stock-badge" [ngClass]="getStockClass(product.cantidad)">{{ product.cantidad }}</span></td>
                  <td>
                    <div class="table-actions">
                      <div class="quantity-selector" *ngIf="productosSeleccionados.has(product.id)">
                        <button type="button" class="quantity-btn" (click)="cambiarCantidad(product.id, -1)">-</button>
                        <input type="number" class="quantity-input" 
                               [value]="productosSeleccionados.get(product.id) || 1" 
                               min="1" [max]="product.cantidad"
                               (change)="actualizarCantidad(product.id, $event)">
                        <button type="button" class="quantity-btn" (click)="cambiarCantidad(product.id, 1)">+</button>
                      </div>
                      <button type="button" class="add-to-cart-btn" 
                              [class.remove-btn]="productosSeleccionados.has(product.id)"
                              (click)="toggleProducto(product.id)">
                        {{ productosSeleccionados.has(product.id) ? 'üóëÔ∏è' : 'üõí' }}
                      </button>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>

          <!-- Resumen de selecci√≥n -->
          <div class="selection-summary">
            <div class="selection-count">{{ productosSeleccionados.size }} productos seleccionados</div>
            <div class="selection-details" *ngIf="productosSeleccionados.size > 0">
              {{ getTotalUnidades() }} unidades total
            </div>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button type="button" class="modal-btn modal-btn-cancel" (click)="cancelar()">
          Cancelar
        </button>
        <button type="submit" class="modal-btn modal-btn-success" [disabled]="!productForm.form.valid">
          Agregar
        </button>
      </div>
    </form>
  </div>
</div>
  