<main>
    <!-- ========================= ENCABEZADO DE LA P√ÅGINA ========================= -->
    <div class="page-header">
        <h2 class="page-title">
            <span class="page-title-icon">üí∞</span>
            Registro de Gastos
        </h2>
    </div>

    <!-- ========================= SECCI√ìN DE ESTAD√çSTICAS ========================= -->
    <div class="section-card">
        <h3 class="section-title">
            <span>üìä</span>
            Estad√≠sticas de Gastos
        </h3>
        
        <div class="stats-container">
            <div class="stat-card">
                <div class="stat-value">{{ formatearMoneda(estadisticas.totalGastosHoy) }}</div>
                <div class="stat-label">Total Gastos Hoy</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">{{ formatearMoneda(estadisticas.totalGastosMes) }}</div>
                <div class="stat-label">Total Gastos Mes</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">{{ estadisticas.gastosRegistrados }}</div>
                <div class="stat-label">Gastos Registrados</div>
            </div>
        </div>
    </div>

    <!-- ========================= SECCI√ìN DE REGISTRO ========================= -->
    <div class="section-card">
        <h3 class="section-title">
            <span>‚ûï</span>
            Nuevo Gasto
        </h3>
        
        <form (ngSubmit)="registrarGasto()" #gastoForm="ngForm">
                <div class="filter-section">
                    <div class="filter-group">
                        <mat-form-field class="full-width">
                            <mat-label>VALOR</mat-label>
                            <input 
                                matInput
                                type="number" 
                                placeholder="0.00" 
                                step="0.01"
                                [(ngModel)]="gastoFormData.valor"
                                name="valor"
                                required>
                            <mat-hint>Ingresa el valor en pesos colombianos</mat-hint>
                        </mat-form-field>
                    </div>
                    <div class="filter-group">
                        <mat-form-field class="full-width">
                            <mat-label>TIPO</mat-label>
                            <mat-select 
                                [(ngModel)]="gastoFormData.tipo"
                                name="tipo"
                                required>
                                <mat-option value="">Seleccionar tipo</mat-option>
                                <mat-option 
                                    *ngFor="let tipo of tiposGasto" 
                                    [value]="tipo.value">
                                    {{ tipo.label }}
                                </mat-option>
                            </mat-select>
                            <mat-hint>Selecciona la categor√≠a del gasto</mat-hint>
                        </mat-form-field>
                    </div>
                    <div class="filter-group">
                        <mat-form-field class="full-width">
                            <mat-label>FECHA</mat-label>
                            <input 
                                matInput 
                                [matDatepicker]="formDatePicker"
                                [(ngModel)]="gastoFormData.fecha"
                                name="fecha"
                                required
                                readonly>
                            <mat-hint>Selecciona la fecha del gasto</mat-hint>
                            <mat-datepicker-toggle matIconSuffix [for]="formDatePicker"></mat-datepicker-toggle>
                            <mat-datepicker #formDatePicker></mat-datepicker>
                        </mat-form-field>
                    </div>
                </div>
                
                <div class="filter-section">
                    <div class="filter-group">
                        <mat-form-field class="full-width">
                            <mat-label>DESCRIPCI√ìN</mat-label>
                            <textarea 
                                matInput
                                placeholder="Describe el gasto detalladamente..."
                                [(ngModel)]="gastoFormData.descripcion"
                                name="descripcion"
                                rows="4"
                                required>
                            </textarea>
                            <mat-hint>Proporciona detalles sobre el gasto realizado</mat-hint>
                        </mat-form-field>
                    </div>
                </div>

                <div class="action-buttons">
                    <button 
                        type="submit" 
                        class="btn-primary"
                        [disabled]="!gastoForm.valid || isLoading">
                        üíæ {{ isLoading ? 'REGISTRANDO...' : 'REGISTRAR' }}
                    </button>
                </div>
            </form>
    </div>

    <!-- ========================= SECCI√ìN DE TABLA DE GASTOS ========================= -->
    <div class="section-card">
        <h3 class="section-title">
            <span>üìã</span>
            Lista de Gastos del D√≠a
        </h3>
        
        <!-- Filtros -->
        <div class="table-header">
            <div class="filters-container">
                <div class="filter-container-group">
                    <mat-form-field class="filter-field">
                        <mat-label>TIPO GASTO</mat-label>
                        <mat-select 
                            [(ngModel)]="filtrosTabla.tipoGasto"
                            (selectionChange)="aplicarFiltros()"
                            name="tipoGastoFiltro">
                            <mat-option value="">Todos los tipos</mat-option>
                            <mat-option 
                                *ngFor="let tipo of tiposGasto" 
                                [value]="tipo.value">
                                {{ tipo.label }}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                </div>
                <div class="filter-container-group">
                    <mat-form-field class="filter-field">
                        <mat-label>FECHA</mat-label>
                        <input 
                            matInput 
                            [matDatepicker]="filterDatePicker"
                            [(ngModel)]="filtrosTabla.fechaFiltro"
                            (dateChange)="aplicarFiltros()"
                            name="fechaFiltro"
                            readonly>
                        <mat-datepicker-toggle matIconSuffix [for]="filterDatePicker"></mat-datepicker-toggle>
                        <mat-datepicker #filterDatePicker></mat-datepicker>
                    </mat-form-field>
                </div>
                <button 
                    class="btn-primary" 
                    (click)="buscarGastos()">
                    üîç BUSCAR
                </button>
            </div>
        </div>

        <!-- Tabla -->
        <div class="table-container">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Fecha</th>
                        <th>Tipo Gasto</th>
                        <th>Descripci√≥n</th>
                        <th>Valor</th>
                        <th>Opci√≥n</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let gasto of gastosDelDia; let i = index">
                        <td>{{ gasto.fecha }}</td>
                        <td>{{ obtenerNombreTipoGasto(gasto.tipoGasto) }}</td>
                        <td>{{ gasto.descripcion }}</td>
                        <td>{{ formatearMoneda(gasto.valor) }}</td>
                        <td>
                            <div class="action-icons">
                                <div 
                                    class="action-icon delete-icon" 
                                    (click)="eliminarGasto(gasto.id)"
                                    title="Eliminar gasto">
                                    üóëÔ∏è
                                </div>
                                <div 
                                    class="action-icon edit-icon" 
                                    (click)="editarGasto(gasto.id)"
                                    title="Editar gasto">
                                    ‚úèÔ∏è
                                </div>
                            </div>
                        </td>
                    </tr>
                    <tr *ngIf="gastosDelDia.length === 0">
                        <td colspan="5" style="text-align: center; padding: 2rem; color: #666;">
                            No hay gastos registrados para mostrar
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Toast Notification Component -->
    <app-toast-notification></app-toast-notification>
</main>

